<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Code Maker â€” HTML/CSS/JS/PHP</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/material-darker.min.css">
<style>
body,html{margin:0;padding:0;height:100%;font-family:Arial, monospace;background:#0b0f14;color:#cbd5df;}
.container{display:flex;height:100%;}
.sidebar{width:260px;background:#10161b;padding:12px;display:flex;flex-direction:column;gap:8px;box-sizing:border-box;}
.sidebar h2{margin:0;font-size:16px;}
input[type=text]{padding:8px;border-radius:6px;border:1px solid #222;background:#071014;color:#cbd5df;width:100%;}
.project-item{padding:8px;background:#0f1520;border-radius:6px;display:flex;justify-content:space-between;cursor:pointer;margin-bottom:6px;}
.project-item:hover{background:#16202a;}
.editor-wrap{flex:1;display:flex;flex-direction:column;min-width:0;}
.tabs{display:flex;background:#10161b;border-bottom:1px solid #12161a;}
.tab{flex:1;padding:10px;text-align:center;cursor:pointer;}
.tab.active{border-bottom:3px solid #58a6ff;}
.editor{flex:1;display:none;position:relative;min-height:0;}
.editor.active{display:block;}
.buttons{display:flex;gap:8px;padding:10px;background:#10161b;}
button{padding:8px 10px;border-radius:6px;border:none;background:#238636;color:white;cursor:pointer;}
button.warn{background:#bf4b4b;}
.CodeMirror{height:100%;font-size:13px;}
.preview-container{height:40%;display:flex;flex-direction:column;transition:height .2s ease;}
.preview-container.collapsed{height:0;}
iframe{flex:1;border:1px solid #111;background:white;}
#htmlErrors{position:absolute;left:0;right:0;bottom:0;background:#2a1515;color:#ffb3b3;padding:6px;font-size:12px;max-height:120px;overflow:auto;}
.note{font-size:12px;color:#9aa3b2;}
</style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <h2>Projects</h2>
    <div id="projectList" style="overflow:auto;max-height:55vh"></div>
    <input id="projectName" placeholder="Project name (my-site)">
    <div style="display:flex;gap:8px">
      <button onclick="saveProject()">ðŸ’¾ Save</button>
      <button onclick="exportZip()">ðŸ“¦ Export ZIP</button>
    </div>
    <button class="warn" onclick="clearAll()">ðŸ—‘ Clear All</button>
    <div class="note">PHP will not execute in preview; it will display as code.</div>
  </div>

  <div class="editor-wrap">
    <div class="tabs">
      <div class="tab active" data-tab="html">HTML</div>
      <div class="tab" data-tab="css">CSS</div>
      <div class="tab" data-tab="js">JS</div>
      <div class="tab" data-tab="php">PHP</div>
    </div>

    <div id="html" class="editor active">
      <textarea id="htmlCode"><!â€” Type HTML here â€”></textarea>
      <div id="htmlErrors"></div>
    </div>
    <div id="css" class="editor"><textarea id="cssCode">/* CSS here */</textarea></div>
    <div id="js" class="editor"><textarea id="jsCode">// JS here</textarea></div>
    <div id="php" class="editor"><textarea id="phpCode"><?php
// PHP code here
?></textarea></div>

    <div class="buttons">
      <button onclick="runPreview()">â–¶ Preview</button>
      <button onclick="togglePreview()">ðŸ–¥ Toggle Preview</button>
    </div>

    <div class="preview-container" id="previewContainer">
      <iframe id="output"></iframe>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/php/php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
const tabs = document.querySelectorAll('.tab');
const editorsDiv = document.querySelectorAll('.editor');
tabs.forEach(tab=>{
  tab.addEventListener('click', ()=>{
    tabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    editorsDiv.forEach(e=>e.classList.remove('active'));
    document.getElementById(tab.dataset.tab).classList.add('active');
    setTimeout(()=>{ htmlEditor.refresh(); cssEditor.refresh(); jsEditor.refresh(); phpEditor.refresh(); },60)
  });
});

const commonOpts = { theme:'material-darker', lineNumbers:true, matchBrackets:true, indentUnit:2, tabSize:2 };
const htmlEditor = CodeMirror.fromTextArea(document.getElementById('htmlCode'), Object.assign({}, commonOpts, { mode:'xml', autoCloseTags:true }));
const cssEditor  = CodeMirror.fromTextArea(document.getElementById('cssCode'), Object.assign({}, commonOpts, { mode:'css' }));
const jsEditor   = CodeMirror.fromTextArea(document.getElementById('jsCode'), Object.assign({}, commonOpts, { mode:'javascript' }));
const phpEditor  = CodeMirror.fromTextArea(document.getElementById('phpCode'), Object.assign({}, commonOpts, { mode:'application/x-httpd-php' }));

function validateHTML(str){
  const tagPattern = /<\/?([a-zA-Z][\w:-]*)\b[^>]*>/g;
  const selfClosing = new Set(['area','base','br','col','embed','hr','img','input','link','meta','param','source','track','wbr']);
  const stack = []; const errors = [];
  let m;
  while((m=tagPattern.exec(str))!==null){
    const raw=m[0], tag=m[1].toLowerCase();
    if(raw.startsWith('</')){
      if(stack.length===0 || stack[stack.length-1]!==tag){errors.push(`Mismatched closing tag </${tag}> at index ${m.index}`);} 
      else stack.pop();
    } else {
      if(!raw.endsWith('/>') && !selfClosing.has(tag)) stack.push(tag);
    }
  }
  stack.reverse().forEach(t=>errors.push(`Unclosed tag <${t}>`));
  return errors;
}
htmlEditor.on('change',()=>{ document.getElementById('htmlErrors').innerHTML = validateHTML(htmlEditor.getValue()).join('<br>'); });

function runPreview(){
  const html = htmlEditor.getValue();
  const css = '<style>'+cssEditor.getValue()+'</style>';
  const js = '<script>'+jsEditor.getValue()+'<\/script>';
  const php = phpEditor.getValue();
  let out = `<div style="padding:8px;background:#ffecec;color:#800;"><strong>PHP code:</strong> Displayed only, not executed.</div>${html}${css}${js}<pre style="background:#f6f8fa;color:#111;padding:8px;">${php.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</pre>`;
  const doc = document.getElementById('output').contentDocument || document.getElementById('output').contentWindow.document;
  doc.open(); doc.write(out); doc.close();
}

function togglePreview(){document.getElementById('previewContainer').classList.toggle('collapsed');}

function saveProject(){
  const name = document.getElementById('projectName').value.trim();
  if(!name){alert('Enter project name');return;}
  const p = { html: htmlEditor.getValue(), css: cssEditor.getValue(), js: jsEditor.getValue(), php: phpEditor.getValue() };
  localStorage.setItem('project_'+name, JSON.stringify(p));
  loadProjects();
  alert('Saved: '+name);
}

function loadProjects(){
  const list = document.getElementById('projectList'); list.innerHTML='';
  Object.keys(localStorage).forEach(k=>{
    if(!k.startsWith('project_')) return;
    const name = k.replace('project_','');
    const div = document.createElement('div'); div.className='project-item';
    const span = document.createElement('span'); span.textContent=name; span.style.flex='1'; span.onclick=()=>openProject(name);
    div.appendChild(span);
    const del = document.createElement('button'); del.textContent='ðŸ—‘'; del.onclick=(e)=>{e.stopPropagation(); if(confirm('Delete '+name+'?')){ localStorage.removeItem(k); loadProjects(); }};
    div.appendChild(del); list.appendChild(div);
  });
}
function openProject(name){
  const p = JSON.parse(localStorage.getItem('project_'+name));
  document.getElementById('projectName').value=name;
  htmlEditor.setValue(p.html||''); cssEditor.setValue(p.css||''); jsEditor.setValue(p.js||''); phpEditor.setValue(p.php||'');
  setTimeout(()=>{ htmlEditor.refresh(); cssEditor.refresh(); jsEditor.refresh(); phpEditor.refresh(); },50);
  runPreview();
}
function clearAll(){ if(!confirm('Delete all saved projects?')) return; Object.keys(localStorage).forEach(k=>{ if(k.startsWith('project_')) localStorage.removeItem(k); }); loadProjects();}
function exportZip(){
  const name = document.getElementById('projectName').value.trim()||'project';
  const zip = new JSZip();
  const php = phpEditor.getValue(), html = htmlEditor.getValue(), css = cssEditor.getValue(), js = jsEditor.getValue();
  if(php){ zip.file('index.php', `<?php\n${php}\n?>\n${html}\n<link rel="stylesheet" href="style.css">\n<script src="script.js"></script>`); }
  else{ zip.file('index.html', `${html}\n<link rel="stylesheet" href="style.css">\n<script src="script.js"></script>`);}
  zip.file('style.css', css||''); zip.file('script.js', js||'');
  zip.generateAsync({type:'blob'}).then(blob=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name+'.zip'; a.click(); URL.revokeObjectURL(a.href); });
}

loadProjects(); runPreview();
</script>
</body>
</html>
